---
title: "LiDAR API"
output: github_document
---

## Goal

We seek to find areas where LiDAR data has been collected on two occasions. Eventually we will use fire perimeter data to find areas where LiDAR was collected before and after a fire.

## Approach

I plan to use the R packages in the [tidyverse](https://www.tidyverse.org) to process data taken from the [web API](https://apps.nationalmap.gov/tnmaccess/#/) provided by [The National Map](https://apps.nationalmap.gov/lidar-explorer/#/). Ultimately, interacting with URLs is performed using a package that ports [curl](https://curl.se/) over to R.

```{r}

# Load R packages
library(tidyverse)
library(jsonlite)
library(curl)

```

## Finding a dataset

We'll need to look at LiDAR products eventually, but to illustrate the general principle, let's be thorough and use the Datasets API to track down the LiDAR data:

```{r}

# Get datasets from the API and convert to a tidy table (tibble)
datasets <- stream_in(url("https://tnmaccess.nationalmap.gov/api/v1/datasets")) %>%
    tibble()

colnames(datasets)

```

So, the Datasets API has provided us with quite a bit of information. Let's examine some variables that look promising.

```{r}

datasets %>%
    select(title, id, lastPublishedDate, lastUpdatedDate, formats)

```

The fifth item appears to be what we're looking for. Let's take a closer look.

```{r}

datasets %>%
    filter(str_detect(title, "Lidar")) %>%
    select_if(is.character) %>% # Can't combine different types of variables in the same column
    pivot_longer(title:zipLink)

```

Not especially helpful. Well, anyways, I've been playing around on the user-friendly [API for data products](https://apps.nationalmap.gov/tnmaccess/#/product) and have learned how to structure URL queries that way, so let's move on to that.

## Finding LiDAR data

